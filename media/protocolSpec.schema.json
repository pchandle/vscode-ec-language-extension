{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Emergent Specification (Protocol)",
  "$ref": "#/$defs/protocolSpec",
  "$defs": {
    "classification4": {
      "type": "string",
      "pattern": "^/(?:[a-z0-9-]+/){3}[a-z0-9-]+$"
    },
    "classification5": {
      "type": "string",
      "pattern": "^/(?:[a-z0-9-]+/){4}[a-z0-9-]+$"
    },
    "requirement": {
      "type": "object",
      "required": [
        "type",
        "name"
      ],
      "oneOf": [
        {
          "properties": {
            "type": {
              "const": "abstraction"
            },
            "protocol": {
              "type": "string"
            }
          },
          "required": [
            "protocol"
          ]
        },
        {
          "properties": {
            "type": {
              "const": "integer"
            },
            "minimum": {
              "type": [
                "number",
                "string"
              ]
            },
            "maximum": {
              "type": [
                "number",
                "string"
              ]
            },
            "hint": {
              "type": [
                "number",
                "string"
              ]
            }
          },
          "required": [
            "minimum",
            "maximum",
            "hint"
          ]
        },
        {
          "properties": {
            "type": {
              "const": "string"
            },
            "length": {
              "type": [
                "number",
                "string"
              ]
            },
            "hint": {
              "type": [
                "number",
                "string"
              ]
            }
          },
          "required": [
            "length",
            "hint"
          ]
        },
        {
          "properties": {
            "type": {
              "const": "boolean"
            }
          }
        },
        {
          "properties": {
            "type": {
              "const": "site"
            }
          }
        }
      ],
      "properties": {
        "type": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "protocol": {
          "type": "string"
        },
        "minimum": {
          "type": [
            "number",
            "string"
          ]
        },
        "maximum": {
          "type": [
            "number",
            "string"
          ]
        },
        "length": {
          "type": [
            "number",
            "string"
          ]
        },
        "hint": {
          "type": [
            "number",
            "string"
          ]
        }
      },
      "additionalProperties": false
    },
    "obligation": {
      "$ref": "#/$defs/requirement"
    },
    "role": {
      "type": "object",
      "required": [
        "requirements",
        "obligations",
        "macro"
      ],
      "properties": {
        "requirements": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/requirement"
          }
        },
        "obligations": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/obligation"
          }
        },
        "macro": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "supplierSpec": {
      "type": "object",
      "required": [
        "type",
        "name",
        "description",
        "requirements",
        "obligations",
        "supplier"
      ],
      "properties": {
        "type": {
          "const": "supplier"
        },
        "name": {
          "$ref": "#/$defs/classification5"
        },
        "description": {
          "type": "string"
        },
        "requirements": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/requirement"
          }
        },
        "obligations": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/obligation"
          }
        },
        "supplier": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "protocolSpec": {
      "type": "object",
      "required": [
        "type",
        "policy",
        "name",
        "description",
        "host",
        "join"
      ],
      "properties": {
        "type": {
          "const": "protocol"
        },
        "policy": {
          "type": "integer"
        },
        "name": {
          "$ref": "#/$defs/classification4"
        },
        "description": {
          "type": "string"
        },
        "host": {
          "$ref": "#/$defs/role"
        },
        "join": {
          "$ref": "#/$defs/role"
        }
      },
      "additionalProperties": false
    }
  }
}